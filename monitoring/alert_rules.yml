# ğŸš¨ Prometheus ì•Œë¦¼ ê·œì¹™
# íŠ¹ì • ì¡°ê±´ì—ì„œ ì•Œë¦¼ì„ ë°œìƒì‹œí‚µë‹ˆë‹¤

groups:
  - name: github-actions-demo
    rules:
      # ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¤ìš´ ì•Œë¦¼
      - alert: ApplicationDown
        expr: up{job="github-actions-demo"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ìš´ë˜ì—ˆìŠµë‹ˆë‹¤"
          description: "GitHub Actions Demo ì• í”Œë¦¬ì¼€ì´ì…˜ì´ 1ë¶„ ì´ìƒ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."

      # ë†’ì€ CPU ì‚¬ìš©ë¥ 
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ë†’ì€ CPU ì‚¬ìš©ë¥ "
          description: "CPU ì‚¬ìš©ë¥ ì´ 80%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤: {{ $value }}%"

      # ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ "
          description: "ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ 85%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤: {{ $value }}%"

      # ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±
      - alert: DiskSpaceLow
        expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 < 10
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±"
          description: "ë””ìŠ¤í¬ ì‚¬ìš©ë¥ ì´ 90%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤: {{ $value }}%"

      # ë†’ì€ ì‘ë‹µ ì‹œê°„
      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ë†’ì€ ì‘ë‹µ ì‹œê°„"
          description: "95% ì‘ë‹µ ì‹œê°„ì´ 1ì´ˆë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤: {{ $value }}ì´ˆ"

      # ì—ëŸ¬ìœ¨ ì¦ê°€
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) * 100 > 5
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ë†’ì€ ì—ëŸ¬ìœ¨"
          description: "5xx ì—ëŸ¬ìœ¨ì´ 5%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤: {{ $value }}%"

      # Docker ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
      - alert: ContainerRestart
        expr: increase(container_restart_count[1h]) > 0
        for: 0m
        labels:
          severity: warning
        annotations:
          summary: "ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘"
          description: "ì»¨í…Œì´ë„ˆê°€ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤: {{ $labels.name }}"
